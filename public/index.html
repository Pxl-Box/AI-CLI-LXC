<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Terminal Workspace</title>

    <!-- xterm.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css?v=1.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <!-- Google Fonts for typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="workspace-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="header-title">
                    <h2>AI Workspace</h2>
                    <button id="btn-settings" class="icon-btn" title="Workspace Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                    </button>
                </div>
                <div class="status-indicator">
                    <span class="dot online"></span>
                    <span class="status-text">Connected</span>
                    <span class="cwd-text" id="current-dir">~</span>
                </div>
                <div class="system-pulse">
                    <span id="sys-cpu">CPU: --%</span> | 
                    <span id="sys-ram">RAM: --/-- GB</span>
                </div>
                <div class="header-actions">
                    <button id="btn-upload" class="icon-btn" title="Upload Asset">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" y1="3" x2="12" y2="15" />
                        </svg>
                    </button>
                    <button id="btn-generated" class="icon-btn" title="Workspace Explorer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" />
                            <circle cx="12" cy="13" r="3" />
                        </svg>
                    </button>
                    <button id="btn-commit" class="icon-btn" title="Commit to Memory">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                    </button>
                    <button id="btn-clear" class="icon-btn" title="Clear Terminal">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18" />
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                            <line x1="10" x2="10" y1="11" y2="17" />
                            <line x1="14" x2="14" y1="11" y2="17" />
                        </svg>
                    </button>
                    <input type="file" id="input-upload" style="display: none;" multiple>
                </div>
            </div>

            <nav class="quick-actions">
                <details open>
                    <summary>Launchers</summary>
                    <div class="section-content">
                        <div class="launcher-group">
                            <select id="gemini-model-select" class="model-select">
                                <option value="">Auto (Gemini 3)</option>
                                <option value="gemini-3.1-pro-preview">Gemini 3.1 Pro (Preview)</option>
                                <option value="gemini-3-flash-preview">Gemini 3 Flash (Preview)</option>
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                            </select>
                            <button class="action-btn primary" id="btn-gemini">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                                </svg>
                                Start Gemini CLI
                            </button>
                        </div>
                        <button class="action-btn secondary" id="btn-claude">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v20" />
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                            </svg>
                            Start Claude Code
                        </button>
                    </div>
                </details>

                <details>
                    <summary>Local LLMs (Ollama)</summary>
                    <div class="section-content">
                        <div class="launcher-group">
                            <select id="local-model-select" class="model-select">
                                <option value="deepseek-r1:1.5b">DeepSeek R1 (1.5b)</option>
                                <option value="deepseek-r1:7b">DeepSeek R1 (7b)</option>
                                <option value="llama3:8b">Llama 3 (8b)</option>
                                <option value="mistral:7b">Mistral (7b)</option>
                                <option value="codellama:7b">CodeLlama (7b)</option>
                                <option value="phi3:3.8b">Phi-3 (3.8b)</option>
                                <option value="custom">Custom Model...</option>
                            </select>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="action-btn primary" id="btn-run-local" style="flex: 1; border-color: rgba(16, 185, 129, 0.3); background: rgba(16, 185, 129, 0.1);">
                                    Run
                                </button>
                                <button class="action-btn secondary" id="btn-pull-local" style="flex: 1;">
                                    Pull
                                </button>
                            </div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary>Agents</summary>
                    <div class="section-content">
                        <div class="header-title">
                            <p class="help-text" style="margin-bottom: 0;">Your custom AI personas.</p>
                            <button id="btn-add-agent" class="icon-btn" title="Create New Agent">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="agents-list" id="agents-list">
                            <!-- Agents will be injected here -->
                        </div>
                    </div>
                </details>

                <details>
                    <summary>Model Usage (Est.)</summary>
                    <div class="section-content">
                        <div class="usage-stats">
                            <div class="usage-item">
                                <div class="usage-info">
                                    <span class="usage-label">Gemini 3 (Series)</span>
                                    <span class="usage-value">15 RPM / 1M TPM</span>
                                </div>
                                <div class="usage-bar"><div class="usage-fill" id="usage-gemini-3" style="width: 0%"></div></div>
                            </div>
                            <div class="usage-item">
                                <div class="usage-info">
                                    <span class="usage-label">Gemini 2.5 (Series)</span>
                                    <span class="usage-value">5 RPM / 128K TPM</span>
                                </div>
                                <div class="usage-bar"><div class="usage-fill" id="usage-gemini-2-5" style="width: 0%"></div></div>
                            </div>
                            <div class="usage-item">
                                <div class="usage-info">
                                    <span class="usage-label">Claude 3.5 Sonnet</span>
                                    <span class="usage-value">Ready</span>
                                </div>
                                <div class="usage-bar"><div class="usage-fill" id="usage-claude" style="width: 0%"></div></div>
                            </div>
                        </div>
                    </div>
                </details>
            </nav>
        </aside>

        <!-- Main Terminal Area -->
        <main class="terminal-section">
            <div class="terminal-header">
                <button id="btn-toggle-sidebar" class="icon-btn sidebar-toggle" title="Toggle Sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="window-controls">
                    <span class="control close"></span>
                    <span class="control minimize"></span>
                    <span class="control maximize"></span>
                </div>
                <div class="terminal-tabs" id="terminal-tabs">
                    <div class="tab active" data-tab-id="default">
                        <span class="tab-title">Main Terminal</span>
                        <button class="tab-close-btn">&times;</button>
                    </div>
                </div>
                <button id="btn-split-view" class="icon-btn" title="Toggle Split View">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="12" y1="3" x2="12" y2="21"/></svg>
                </button>
                <button id="btn-add-tab" class="icon-btn add-tab-btn" title="Open New Chat/Agent">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
            </div>
            <div id="terminal-container"></div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Workspace Settings</h3>
                <button class="close-btn" id="btn-close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Workspace Explorer</label>
                    <p class="help-text">Click folders to browse. Assign workspaces to automatically isolate context.
                    </p>

                    <div class="browser-container">
                        <div class="browser-header">
                            <button id="btn-up-dir" class="action-btn small secondary" title="Go Up One Directory">↑
                                Up</button>
                            <input type="text" id="input-browser-path" class="browser-path-input" readonly
                                autocomplete="off">
                        </div>
                        <div class="browser-list" id="browser-list">
                            <!-- Folders inject here -->
                        </div>
                        <div class="browser-actions">
                            <input type="text" id="input-new-folder" placeholder="New folder name..."
                                autocomplete="off">
                            <button id="btn-create-folder" class="action-btn small primary">Create</button>
                        </div>
                    </div>
                </div>

                <div class="form-group workspace-assignments">
                    <h4>Current Assignments</h4>
                    <div class="assignment-row">
                        <span class="model-badge gemini">Gemini</span>
                        <input type="text" id="input-gemini-path" readonly placeholder="Default Workspace (~) ">
                        <button class="action-btn small primary" id="btn-assign-gemini">Assign Focus</button>
                    </div>
                    <div class="assignment-row">
                        <span class="model-badge claude">Claude</span>
                        <input type="text" id="input-claude-path" readonly placeholder="Default Workspace (~)">
                        <button class="action-btn small secondary" id="btn-assign-claude">Assign Focus</button>
                    </div>
                </div>

                <div class="form-group" style="padding-top: 1rem; border-top: 1px solid var(--border-color); margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4>Saved Projects</h4>
                        <button class="action-btn small primary" id="btn-save-project" title="Save current explorer path as a project">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save Current Path
                        </button>
                    </div>
                    <p class="help-text" style="margin-bottom: 1rem;">Save frequently used workspace paths for quick assignment.</p>
                    <div id="saved-projects-list" style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 200px; overflow-y: auto;">
                        <!-- Saved projects inject here -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Asset Storage Path</label>
                    <p class="help-text">Where uploaded files are stored. Defaults to active workspace.</p>
                    <div class="assignment-row">
                        <input type="text" id="input-asset-path" readonly placeholder="Same as Workspace">
                        <button class="action-btn small secondary" id="btn-assign-asset">Set Storage</button>
                    </div>
                </div>

                <div class="form-group" style="background: rgba(139, 92, 246, 0.05); padding: 1rem; border-radius: 8px; border: 1px dashed var(--brand-gemini);">
                    <label>Import Project (ZIP)</label>
                    <p class="help-text">Unpack a project directly into the active workspace.</p>
                    <div class="launcher-group">
                        <button class="action-btn secondary" id="btn-import-zip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Upload & Extract ZIP
                        </button>
                        <input type="file" id="input-workspace-zip" style="display: none;" accept=".zip">
                    </div>
                </div>

                <div class="form-group" style="border-top: 1px solid var(--border-color); padding-top: 1rem;">
                    <button class="action-btn danger small" id="btn-restart-term">Force Restart Terminal
                        Process</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Modal -->
    <div class="modal-overlay" id="agent-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Agent</h3>
                <button class="close-btn" id="btn-close-agent">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Agent Name</label>
                    <div class="input-row">
                        <input type="text" id="input-agent-name" placeholder="e.g., Code Reviewer">
                    </div>
                </div>
                <div class="form-group">
                    <label>Base Model</label>
                    <select id="select-agent-model" class="model-select">
                        <option value="">Auto (Gemini 3)</option>
                        <option value="gemini-3.1-pro-preview">Gemini 3.1 Pro (Preview)</option>
                        <option value="gemini-3-flash-preview">Gemini 3 Flash (Preview)</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                        <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                        <option value="claude">Claude 3.5 Sonnet</option>
                    </select>
                </div>
                <div class="form-group textarea-group">
                    <label>System Instructions (Prompt)</label>
                    <textarea id="input-agent-prompt" placeholder="Define the agent's behavior, expertise, and tone..."></textarea>
                </div>
                <div class="form-group">
                    <button class="action-btn primary" id="btn-save-agent">Create Agent</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace Explorer Modal -->
    <div class="modal-overlay" id="generated-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Workspace Explorer</h3>
                <button class="close-btn" id="btn-close-generated">&times;</button>
            </div>
            <div class="modal-body">
                <div class="browser-header" style="margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    <button id="btn-explorer-up" class="action-btn small secondary" style="padding: 0.4rem 0.8rem;">↑ Up</button>
                    <button id="btn-explorer-mkdir" class="icon-btn" title="Create New Folder" style="padding: 0.4rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/><line x1="12" y1="10" x2="12" y2="16"/><line x1="9" y1="13" x2="15" y2="13"/></svg>
                    </button>
                    <span id="explorer-current-path" class="help-text" style="margin: 0; padding-left: 0.5rem; font-family: 'Fira Code', monospace; font-size: 0.75rem; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">/</span>
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <input type="text" id="input-explorer-search" placeholder="Search files in current folder..." 
                        style="width: 100%; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 6px; color: var(--text-primary); font-size: 0.85rem;"
                        autocomplete="off">
                </div>
                <div class="browser-list" id="generated-list" style="height: 300px;">
                    <!-- Files and Folders inject here -->
                </div>
                <div class="modal-footer" style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <div id="explorer-selection-count" class="help-text" style="margin: 0;">0 files selected</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="action-btn small secondary" id="btn-gather-context" title="Auto-select architectural files">Gather Context</button>
                        <button class="action-btn small secondary" id="btn-mention-selected" disabled>Mention Selected</button>
                        <button class="action-btn small secondary" id="btn-mention-all">Mention All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div class="modal-overlay" id="preview-modal">
        <div class="modal-content" style="max-width: 800px; width: 95vw; height: 85vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 id="preview-title">File Preview</h3>
                <button class="close-btn" id="btn-close-preview">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0; flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                <pre class="preview-code-container" style="margin: 0; flex: 1; overflow: auto; background: #000; border-radius: 0 0 8px 8px;"><code id="preview-code" class="language-javascript" style="font-size: 0.85rem;"></code></pre>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="main.js?v=1.1"></script>
</body>

</html>